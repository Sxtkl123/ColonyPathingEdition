# Changelog
## 1.0
- 红树树苗补种时将不再出现位移。
- 林务员补种树苗时将会查看背包内是否有合适数量的树苗，凑齐后一次性补种。
- 增加农田对farmers delight的水稻的相关支持。
- 快递员将更不愿意返回仓库，且低等级快递员开启的槽位更多。
- 寻路cost修改
    1. 铁路cost现在一定为固定值
    2. 将探测铁轨设置为站点方块，在探测铁轨处下车将没有下车cost
    3. 增加路径方块对复杂地形cost的削减，并略微提升路径方块cost
    4. 调高水路cost
    5. 降低一部分摔落cost
    6. 增加panel cost
    7. 调整楼梯cost，现在楼梯只有在爬升方向正确时不计cost
    8. 在道路上上升或下降1格现在均不计cost
## 1.0.1
- 启发值修改，现在距离目的地越远启发值增加速度越快。
- 现在在铁路上和在路径方块上启发值依信赖度比例降低。
- 如果在铁路或路径方块上，远离目标点时启发值仅增加其cost值。
- 增加了对台阶的支持，删除在道路上上升或下降1格现在均不计cost的设定，现在改为上升或下降0.5格不计cost，楼梯下降1格仍不计cost。
- 修改了所有距离的计算，y轴现在的权重为x和z的1/5。
- 修改了村民非紧急寻路的启发值计算方式，修改为欧氏距离，入侵者启发值修改为切比雪夫距离。
- 修改了养殖场保留动物的下限，现在高级的养殖场将倾向于保留更多的成年动物以供繁殖。
- 修改了养殖户的动作延迟，现在其决策速度将更快。
- 对corner节点逻辑进行部分修改，下落的corner现在不会进行水平探索。
## 1.0.2-snapshot
- 进一步修改corner节点，现在corner节点仅作存储，不与任何节点相连，且不会做任何扩张动作。(预计会出现不稳定的情况)
测试中修复的bug:跳跃卡灯/两点同时摔落到一点时cost缺失/试图走上高两格的楼梯/平面路径选择corner节点作为中间节点
- 现在寻路时最优点启发值越高，可扩展的节点数越高，体现为绕障能力进一步加强。
- 增加铁路连接检测，现在市民可以辨识未正确连接的铁路并下车
- 修复市民路径卡住检测，目前流程修改如下
    1. 未到路径终点尝试短距离传送，传送后立即重新寻路，否则仅重新寻路。若在路径中被卡住6次则直接传送至终点。
    2. 袭击在被卡住之后将会先重新尝试寻路，在寻路超过6次后不停尝试搭梯子/方块或者破坏方块，每次破坏方块后将会重新尝试寻路。
    3. 以上每个动作的延迟依旧沿用minecolonies原设计，在进一步测试后再尝试修改。
- 修复"下落到厚度过低的方块"类节点无法扩展的问题。
- 修复梯子上的寻路问题，避免市民切换梯子。
- 将梯子以及其上方可行走的位置视为路径方块。
## 1.0.2
- 进一步修改市民卡住逻辑
    1. 重新寻路逻辑使用罚函数限制位置，并降低路径中卡住上限至4次。
    2. 重新寻路逻辑目标地点改为目标位置y轴+xz轴当前位置与目标地点连线延长线上一点，若目标地点与当前位置xz轴重合，则随机选取较远的xz轴。
    3. 4次重新寻路的距离为20-40-60-80，如果重合距离恒为80。
- 市民进食逻辑修改
    1. 食物质量计算修改为近期十次食物的营养值(公式见注1)之和，殖民地食物可以认为营养值为1。
    2. 食物丰富度计算修改为近期十次食用食物种类乘max(2×营养值，1)之和，殖民地食物依旧计1食物丰富度。
    3. 当食物质量和食物丰富度满足原版要求(大于等于住宅等级)时，将会触发在工作小屋选取食物进食的选项(可以与最低存量配合)。 (不过现在还有一些逻辑bug,后面会逐步修复)
    4. 厨师(cook)和主厨(chef)现在前往餐厅后不会等待厨师送饭，而是直接取食。
    5. 市民会选取就近餐厅吃饭，而不是距离自己工作方块最近的餐厅或者距离自己家最近的餐厅。
    6. 市民在餐厅自行取食时会取足够多的食物，而不会少拿一个。
    7. 厨师(cook)不会触发在自己岗位吃饭，而是直接去餐厅(触发的流程不一样，这样预计会稳定一些，不然会把餐厅饭拿光饿着在餐厅的村民)
    8. 在触发工位吃饭逻辑的时候会先做判断，如果就近餐厅更近会直接去餐厅，但主厨(chef)一定会先去自己的工作岗位。
    9. 如果餐厅没有食物，市民会再次触发返回工作岗位吃饭，此时取食无视丰富度和质量条件。
- 如果市民有紧急事件堵塞进程，会前往市政厅寻找可以交互的玩家。
## 1.0.3-ALPHA-1
- 你现在可以在创造模式中尝试编辑自己殖民地中的路径类型
    需要使用structurize的标记工具绑定殖民地的市政厅，将殖民地内的方块附加以下标签即可使市民遵循规则行走。
    - "path":将会使非路径方块被视为路径方块
    - "not_path":将会使路径方块被视为非路径方块(判定先于"path"标签)
    - "blocked":村民将不会走到此方块上/走进此方块(判定先于前两个标签)
- 修复市民会前往错误的位置进食的bug
## 1.0.3-ALPHA-2
- 餐厅、厨房、医院、冶石场工人上限数改变为 floor((建筑等级+1)/2)，也即：初始为1，每升2级可增加1个工人。
- 现在工人在向熔炉内放置物品的同时会取出已经烧制好的物品。
- 修复corner节点认为分布在3格中的2格高缝隙不可通过的问题(碰撞箱比较奇特的(如开启的panel)依旧不能识别，等待后续修复)
## 1.0.3-ALPHA-3
- **修复了前述版本中寻路导致存档崩溃的问题，建议选择1.0.3-ALPHA-4以后的版本作为稳定版本或者在前述版本中阻止村民前往y轴为负的位置。**
- **修复了执行绕路操作可能报错的问题。**
- 医院与疾病AI更新内容(存在问题)
    1. 医生现在在袭击发生时仍会工作，但不会在袭击时主动离开医院对市民进行治疗。
    2. 大幅加强医生的治疗能力/免费治疗概率。
    3. 修改了市民AI，提升市民尝试前往医院的血量。
    4. 市民生病自愈时间大幅下调，并会在整个SICK状态下统计生病时间。
    5. 卫兵AI调整，其逃跑时如果殖民地内存在医院，会前往最近的医院等待治疗，同时尝试修复袭击时逃跑后可能无法反击的问题。
    6. 尝试实现多个医生不会同时治疗一个市民。
## 1.0.3-ALPHA-4
- 稳定上述医院与疾病AI更新内容。
- 将前置minecolonies版本提高至1.1.936。
## 1.0.3-ALPHA-5
- 优化进食AI，如果市民因为饥饿而有缓慢效果时，如果它处于进食AI寻路过程中，会额外赋予速度III效果。也即市民将会在很饿的时候飞奔去工作岗位和前往餐厅吃饭。
- 实现多个医生不会同时治疗一个市民。
- 市民在受到环境(非坠落)伤害，且血量达到临界血量之下(可以通过config调整)时，将会tp到安全位置。
- 普通市民在受到实体(非玩家)伤害时，如果血量达到临界血量之下会立即主动逃往医院 (如果有的话)。
## 1.0.3-ALPHA-6
- 市民自愈调整为 480s~2480s 间均匀自愈，2480s 后直接自愈。补充NBT，现在退出游戏后市民会记住自己的生病时间。
- 修改熔炉工作设定。
    1. 每个工人都能够为结构内的熔炉提供稳定的加速和燃料燃烧时间延长，单人最多每20tick延长燃烧时间6tick，加速进度60tick。
    2. 实现多个工人分工，工人在开始工作时会占用熔炉，阻止其他工人读取，从而实现并行，不过可能会有工人无熔炉可用。
    3. 工人拿取烧制物品时也会掉落经验，这应该可以加速工人升级。
    4. 取消所有与熔炉是否被点燃相关的重要流程，包括放置燃料，放置原料，判定使用熔炉数量等。
    5. 修改了物品分炉策略，保证单炉至少烧制8个物品。
## 1.0.3-ALPHA-7
- **修复寻路时市政厅无法读取导致游戏崩溃的bug。**
- 可以选择林务员小屋是否在0级开始工作(仅有部分功能)，可以在config中调整，默认为false。
- 继续修改熔炉工作设定。
    1. 现在除了厨房以外，每个工人都只能加速自己占用的熔炉，但是加速效果增强至最多每20tick延长燃烧时间18tick，加速进度178tick。
    2. 物品拿取实现多个工人分工，熔炉只允许一个人来取走产物，且在烧制完成后会先尝试让原本占用的工人来取走产物。
    3. 如果工人无炉可用，会随机选取结构内的一个非自己占用的熔炉进行加速。
    4. 修复了工人熔炉可能灯灭却在烧制的显示bug。(其实是我机制写的问题)
    5. 更改了物品分炉策略。
## 1.0.3-ALPHA-8
- 厨房的多个工人将可以分工，而且会一次性拿取一系列食物并分配给多个饥饿的市民，厨师一次性服务的市民数量由其等级决定。
## 1.0.3-ALPHA-9
- **修复新厨师体系与minecolony_tweaks的冲突。**
## 1.0.3-ALPHA-10
- **修复无职业村民可能卡住进食AI的问题**
- **尝试修复兼容水稻的部分可能导致与minecolony_tweaks的冲突使得南瓜和西瓜无法种植的问题**
- 将日志从txt格式修改为markdown格式 (sxtkl)
- 新增了多种建筑工的建筑模式，可在配置项内自行配置 (sxtkl)
    - 常规(`NORMAL`)：原汁原味的建筑工体验！
    - 形式主义者(`FORMALIST`)：建筑工会颇具表演天赋！开始表演如何在工地上蹿下跳（实际上他们的手是无限长的，在出发的一刻就已经开始建筑了）
    - 哨兵(`SENTRY`)：简易殖民地的建筑工体验！建筑工会站在工地的一个地方一直建造，不再移动。
    - 创世神(`GOD`)：建筑工将在他们的小屋随心所欲的建筑！
    - 长臂猿(`GIBBON`)：建筑工将像一个长臂猿一样，在工地上蹿下跳，但是与形式主义者不同，他们的手并不是无限长的；同时不同于原版，他们会一边移动一边建造，且建造距离可配置。
- 将下方是梯子的方块路径类型从 ladder 移动至 onRoad。
- 现在医院在夜晚也会有一个人值班，行动模式为：无伤员时打盹，有伤员时醒来并治疗。
- 修改厨师的服务策略，高级餐厅顾客较少时会大概率空出一个工人烧制食物。
- 将殖民地食物丰富度和质量的计算改为基础食物附加奖励值。
## 1.0.3-ALPHA-11
- **修复医生无法请求药品的问题**
- **修复无法播报所有市民已上床的问题**
- **(或许)修复哨兵模式下可能引起建筑工卡住的问题**
- 餐厅将在夜晚前105秒停止服务，此后或此前所有进入的市民都直接拿取食物。
- 林务员将返回检查上一棵树的掉落物，同时检测范围扩大至15×18(-2~+16)×15。
- [ ] 将模组重命名为：colony++，命名空间修改为colonypp
- [ ] 修改市民取货逻辑，对于非快递员类市民，其取货均可以在对应的小屋进行
- [ ] 修改建筑工接单逻辑，使其可以随时随地接单